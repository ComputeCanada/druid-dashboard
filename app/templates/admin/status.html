{# --------------------------------------------------------------------------
                                                                      html
-------------------------------------------------------------------------- #}

<h3>Status</h3>

<div class='statuses'>

<table>
  <caption>Components</caption>
  <thead>
    <tr>
      <th></th>
      <th>Cluster</th>
      <th>Service</th>
      <th>Last heard from</th>
    </tr>
  </thead>
  <tbody id='components'>
  </tbody>
</table>

</div>

{# ---------------------------------------------------------------------------
                                                                  scriptage
--------------------------------------------------------------------------- #}

<script>

  function get_components(event, ui) {
    console.log("In get_components()");
    $.ajax({
      url: '/xhr/components/',
      method: 'GET',
      success: display_components,
      error: function() { console.error("get_components() AJAX error"); }
    });
  }

  function display_components(components, status, jqXHR) {

    // clear out body of table, leaving header and footer intact
    var tbody = document.getElementById("components");
    tbody.innerHTML = "";

    // create row for each component
    if (components) {
      for (component of components) {
        r = document.createElement("tr");
        r.innerHTML = `
          <td>${component['name']}</td>
          <td>${component['cluster']}</td>
          <td>${component['service']}</td>
          <td>${component['lastheard'] === null ? "Never checked in" : component['lastheard']}</td>`;
        tbody.appendChild(r);
      }
    } else {
      r = document.createElement("tr");
      r.innerHTML = "<td colspan=4>There are currently no components defined, or checking in.</td>";
      tbody.appendChild(r);
    }
  }

  window.addEventListener("load", function() {
    // load components
    get_components();
  });
</script>
